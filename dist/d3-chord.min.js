"use strict";!function(t){t.module("d3-chord",[])}(angular),function(t){function e(){var t=function(){function t(t){var e=d[t.source.index],n=d[t.target.index];return e<n?e+"__"+n:n+"__"+e}var e,n,r=[],a=[],o={},i=[],d=[],u={},c=function(){},s=function(){},l={};return l.update=function(){r=[],a=[],o={},n={groups:{},chords:{}},this.groups().forEach(function(t){n.groups[t._id]={startAngle:t.startAngle,endAngle:t.endAngle}}),this.chords().forEach(function(e){n.chords[t(e)]={source:{_id:e.source._id,startAngle:e.source.startAngle,endAngle:e.source.endAngle},target:{_id:e.target._id,startAngle:e.target.startAngle,endAngle:e.target.endAngle}}}),d=Object.keys(u);for(var l=0;l<d.length;l++){r[l]||(r[l]=[]);for(var g=0;g<d.length;g++)a=i.filter(function(t){return c(t,u[d[l]],u[d[g]])}),o=s(a,u[d[l]],u[d[g]]),o.valueOf=function(){return+this.value},r[l][g]=o}return e.matrix(r),r},l.data=function(t){return i=t,this},l.filter=function(t){return c=t,this},l.reduce=function(t){return s=t,this},l.layout=function(t){return e=t,this},l.groups=function(){return e.groups().map(function(t){return t._id=d[t.index],t})},l.chords=function(){return e.chords().map(function(e){return e._id=t(e),e.source._id=d[e.source.index],e.target._id=d[e.target.index],e})},l.addKey=function(t,e){u[t]||(u[t]={name:t,data:e||{}})},l.addKeys=function(t,e){for(var n=0;n<i.length;n++)for(var r=0;r<t.length;r++)this.addKey(i[n][t[r]],e?e(i[n],t[r]):{});return this},l.resetKeys=function(){return u={},this},l.groupTween=function(t){return function(e,r){var a,o=n.groups[e._id];return a=o?d3.interpolateObject(o,e):d3.interpolateObject({startAngle:e.startAngle,endAngle:e.startAngle},e),function(e){return t(a(e))}}},l.chordTween=function(t){return function(e,r){var a,o,i=n.chords[e._id];if(i)e.source._id!==i.source._id&&(i={source:i.target,target:i.source}),a=d3.interpolateObject(i,e);else{if(n.groups){o=[];for(var d in n.groups)i=n.groups[d],i._id!==e.source._id&&i._id!==e.target._id||o.push(i);o.length>0?(i={source:o[0],target:o[1]||o[0]},e.source._id!==i.source._id&&(i={source:i.target,target:i.source})):i=e}else i=e;a=d3.interpolateObject({source:{startAngle:i.source.startAngle,endAngle:i.source.startAngle},target:{startAngle:i.target.startAngle,endAngle:i.target.startAngle}},e)}return function(e){return t(a(e))}}},l.read=function(t){var e,n={};return t.source?(n.sname=t.source._id,n.sdata=t.source.value,n.svalue=+t.source.value,n.stotal=r[t.source.index].reduce(function(t,e){return t+e},0),n.tname=t.target._id,n.tdata=t.target.value,n.tvalue=+t.target.value,n.ttotal=r[t.target.index].reduce(function(t,e){return t+e},0)):(e=u[t._id],n.gname=e.name,n.gdata=e.data,n.gvalue=t.value),n.mtotal=r.reduce(function(t,e){return t+e.reduce(function(t,e){return t+e},0)},0),n},l};return{chordMatrix:t}}function n(t,e){var n=["#52c3f1","#f77b6b","#e3d64a","#6767da","#68d4b2","#369d97","#74d9ed","#f8a13f","#dae342","#8d7be3","#a4e59b","#54becc"];return{restrict:"EA",template:"<div id='d3-{{$id}}' class='d3-container d3-chord'>\n                        <div class='tooltip'></div>\n                        <div class='empty-mask'>未查询到数据</div>\n                        <div class='loading' >loading...</div>\n                       </div>",replace:!0,scope:{config:"=",dimension:"="},bindToController:!0,controllerAs:"chart",controller:["$scope","$element",function(r,a){function o(t){d3.event.preventDefault(),d3.event.stopPropagation();var e=m.config;e.callback&&e.callback.groupClick&&(e.callback.groupClick(t),r.$$phase||r.$root.$$phase||r.$apply()),g()}function i(t){d3.event.preventDefault(),d3.event.stopPropagation(),f(t),d(t)}function d(t){A.show();var e=m.config;if(e.tooltip.formatter){var n=e.tooltip.formatter(P.read(t));A.css({left:d3.event.offsetX+20,top:d3.event.offsetY+20}).html(n)}}function u(){d3.event.preventDefault(),d3.event.stopPropagation(),A.hide(),g()}function c(){y.show()}function s(){y.hide()}function l(t){x.hide(),t&&0==t.length&&x.show()}function g(){d3.event.preventDefault(),d3.event.stopPropagation(),O.selectAll("path.chord").style("opacity",.9)}function f(t){d3.event.preventDefault(),d3.event.stopPropagation(),O.selectAll("path.chord").style("opacity",function(e){return t.source?e._id===t._id?.9:.1:e.source._id===t._id||e.target._id===t._id?.9:.1})}function h(t){t.data?(s(),l(t.data)):c();var e=t.data||[];P.data(e).resetKeys().addKeys(["node1","node2"]).update();var n=O.selectAll("g.group").data(P.groups(),function(t){return t._id}),r=n.enter().append("g").attr("class","group");r.append("path").on("click",o).on("mouseover",f).on("mouseout",g).style("fill",function(t){return $(t._id)}).attr("d",T),r.append("text").style("pointer-events","none").style("font-size","9px").attr("dy",".35em").text(function(t){return t._id}),n.select("path").transition().duration(2e3).attrTween("d",P.groupTween(T)),n.select("text").transition().duration(2e3).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;var e="rotate("+(180*t.angle/Math.PI-90)+")",n=" translate("+(M+26)+")";return e+n+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"}),n.exit().select("text").attr("fill","orange"),n.exit().select("path").remove(),n.exit().transition().duration(1e3).style("opacity",0).remove();var a=O.selectAll("path.chord").data(P.chords(),function(t){return t._id});a.enter().append("path").attr("class","chord").style("fill",function(t){return $(t.source._id)}).attr("d",j).on("mouseover",i).on("mouseout",u),a.transition().duration(2e3).attrTween("d",P.chordTween(j)),a.exit().remove()}function p(){var t=[],e=m.dimension,n=_[0].clientWidth,r=void 0,a=[1,1];return e?(a=e.split(":").reverse().map(Number),r=n*a[0]/a[1]):r=_[0].clientHeight,n<50&&(n=500,r=500),t[0]=n-w[1]-w[3],t[1]=r-w[0]-w[2],{width:n,height:r,dims:t}}function v(){b=p(),K.attr({width:b.width,height:b.height})}var m=this,_=a,A=_.find(".tooltip"),y=_.find(".loading"),x=_.find(".empty-mask"),w=[50,50,50,50],b=p(),$=d3.scale.ordinal().range(n),k=d3.layout.chord().padding(.02).sortGroups(d3.descending).sortSubgroups(d3.ascending),P=e.chordMatrix().layout(k).filter(function(t,e,n){return t.node1===e.name&&t.node2===n.name||t.node1===n.name&&t.node2===e.name}).reduce(function(t,e,n){var r=void 0;return r=t[0]?t.reduce(function(t,r){return e===n?t+(r.weight1+r.weight2):t+(r.node1===e.name?r.weight1:r.weight2)},0):0,{value:r,data:t}}),M=b.dims[1]/2-100,T=d3.svg.arc().innerRadius(M).outerRadius(M+20),j=d3.svg.chord().radius(M),K=d3.select(_[0]).append("svg").attr("class","chart").attr({width:b.width+"px",height:b.height+"px"}).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" "+b.height),O=K.append("g").attr("class","g-container").attr("transform","translate("+(b.dims[0]/2+w[3])+","+(b.dims[1]/2+w[0])+")");c(),v(),r.$watch("chart.config",function(t,e){h(m.config)},!0),t.addEventListener("resize",function(){v()})}]}}t.module("d3-chord").factory("matrixFactory",e),t.module("d3-chord").directive("d3Chord",n),n.$inject=["$window","matrixFactory"]}(angular);
//# sourceMappingURL=d3-chord.min.js.map
